{% extends "base.html" %}

{% block styles %}
	{{ super() }}
  <link rel="stylesheet" href="{{ 'assets/stylesheets/polkadot.css' | url }}">
{% endblock %}

{% block fonts %}
  {#-
    Add Google Fonts here
  -#}
  {{ super() }}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hammersmith+One&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
{% endblock%}

{% block site_meta %}
  {{ super() }}
  {% if page and page.meta and page.meta.keywords %}
    <meta name="keywords" content="{{ page.meta.keywords }}">
  {% endif %}
{% endblock %}

{%- block htmltitle -%} 
  {%- if page.is_homepage -%} 
    <title>Draft Docs for Polkadot Ecosystem</title> 
  {%- elif page and page.meta and page.meta.title -%} 
    <title>{{ page.meta.title }} | {{ config.site_name }}</title> 
  {%- elif page and page.title and not page.is_homepage -%} 
    <title>{{ page.title }} | {{ config.site_name }}</title> 
  {%- else -%}
    <title>{{ config.site_name }}</title> 
  {%- endif -%} 
{%- endblock -%}

{% block announce %}
  <span aria-hidden="true">ðŸŽ‰</span>
  Smart Contracts on
  <a
    href="/smart-contracts/connect/"
    target="_blank"
    rel="noopener noreferrer"
    style="font-weight: bold;"
  >
   Polkadot
  </a>
  are now live!
  <a
    href="https://www.parity.io/blog/why-developers-should-deploy-smart-contracts-on-polkadot"
    target="_blank"
    rel="noopener noreferrer"
    style="font-weight: bold;"
  >
    Learn why you should deploy on Polkadot
  </a>
  .
{% endblock %}


{% block libs %}
  {{ super() }}
  <link rel="preconnect" href="https://widget.kapa.ai/">
  <style data-emotion="mantine" data-s=""></style>
  <script defer
    src="https://widget.kapa.ai/kapa-widget.bundle.js"
    data-website-id="3fbec0cf-5f4b-4f78-9cff-4ebf071c3bd3"
    data-user-analytics-cookie-enabled="false"
    data-project-name="Polkadot"
    data-modal-title="Polkadot AI Chatbot"
    data-project-color="#1E1E1E"
    data-button-hover-animation-enabled="false"
    data-button-text-color="var(--color-text-primary)"
    data-button-text-font-size="14px"
    data-button-position-right="unset"
    data-button-position-bottom="unset"
    data-button-height="unset"
    data-button-width="unset"
    data-button-padding="0"
    data-button-bg-color="transparent"
    data-button-border="none"
    data-button-box-shadow="none"
    data-button-animation-enabled="false"
    data-button-image-height="0px"
    data-button-image-width="0px"
    data-font-size-xs="12px"
    data-font-size-sm="14px"
    data-font-size-md="16px"
    data-font-size-lg="18px"
    data-font-size-xl="22px"
    data-modal-title-font-size="22px"
    data-query-input-font-size="16px"
    data-modal-header-bg-color="var(--color-surface)"
    data-modal-image-height="24px"
    data-modal-image-width="24px"
    data-project-logo="/assets/images/polkadot.png"
    data-modal-title-color="white"
    data-modal-disclaimer="This is an AI chatbot trained to answer questions about Polkadot. As such, the answers it provides might not always be accurate or up-to-date. Please use your best judgement when evaluating its responses. Also, **please refrain from sharing any personal or private information with the bot**. By submitting a query, you agree that you have read and understood [these conditions](https://polkadot.com/legal-disclosures/).
      **If you need further assistance, you can reach out to [Polkadot Support](https://support.polkadot.network/support/tickets/new?ticket_form=i_have_a_support_request).**"
    data-modal-disclaimer-font-size="12px"
    data-search-mode-enabled="false"
    data-search-mode-default="false"
    data-search-result-primary-title-font-size="16px"
  ></script>
{% endblock %}

{% block site_nav %} 
{#- Navigation (left menu) -#} 
  {% if nav %}
    {% if page.meta and page.meta.hide %} 
      {% set hidden = "hidden" if "navigation" in page.meta.hide %} 
    {% endif %}
    <div
      class="md-sidebar md-sidebar--primary"
      data-md-component="sidebar"
      data-md-type="navigation"
      {{ hidden }}
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          {% include "partials/nav.html" %}
        </div>
      </div>
    </div>
  {% endif %} 
  
  {#- Table of contents (TOC) -#} 
  {% if "toc.integrate" not in features %} 
    {% if page.meta and page.meta.hide %} 
      {% set hidden = "hidden" if "toc" in page.meta.hide %} 
    {% endif %}
    <div
      class="md-sidebar md-sidebar--secondary"
      data-md-component="sidebar"
      data-md-type="toc"
      {{ hidden }}
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          {#- TOC -#} 
          {% include "partials/toc.html" %}
        </div>

        {#- Feedback and Edit this page container -#}
        <div class="feedback-actions-container">
          {#- Feedback Section -#}
          {% include "partials/feedback.html" %}

          {#- Edit this Page Section -#}
          <div class="edit-section">
            {% include "partials/actions.html" %}
          </div>
        </div>
      </div>
    </div>
  {% endif %} 
{% endblock %}

{%- block container -%}
<div class="md-content" data-md-component="content">
  {% set class = "index-page" if not page.content %}
  <article class="md-content__inner md-typeset {{ class }}">
    {% block content %} 
      {% include "partials/content.html" %} 
    {% endblock %}
  </article>
</div>
{%- endblock -%} 

{% block scripts %} 
  {{ super() }}
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {

      const searchToggle = document.querySelector('[data-md-toggle="search"]');

      searchToggle?.addEventListener('change', () => {
        document.body.toggleAttribute(
          'data-search-open',
          searchToggle.checked
        );
      });

      document.body.addEventListener('click', (event) => {
        if (event.target.id === 'kapa-widget-container') {
          event.target.addEventListener('keydown', (event) => {
            event.stopPropagation();
          });
        }
      });

      const widgetHost = document.querySelector('#kapa-widget-container');
      const kapaWidget = widgetHost?.shadowRoot;
      if (!kapaWidget) return;

      /*
        In order to customize the Kapa AI widget, we need to manipulate its shadow DOM.
        
        This script performs the following actions:
          1. Wraps existing shadow root content in a new div for easier styling.
          2. Adds a "Get Support" link to the widget.
          3. Observes mutations in the shadow DOM to apply custom styles and hide unwanted elements
      */

      /* --- 1. Add wrapper around the shadow root --- */
      const shadowRootWrapper = document.createElement('div');
      shadowRootWrapper.className = 'kapa-shadow-root-wrapper';

      // Move all existing children into the wrapper
      while (kapaWidget.firstChild) {
        shadowRootWrapper.appendChild(kapaWidget.firstChild);
      }

      // Insert the wrapper back into the shadow root
      kapaWidget.appendChild(shadowRootWrapper);

      /* --- 2. Create get support link and add to the shadow root --- */
      const supportWrapper = document.createElement('div');
      supportWrapper.classList.add('support-container');

      const supportLink = document.createElement('a');
      supportLink.href = '/get-support/';
      supportLink.textContent = 'Get Support';
      supportLink.classList.add('support-link');

      supportWrapper.appendChild(supportLink);
      shadowRootWrapper.prepend(supportWrapper);

      /* --- 3. Observe mutations in the shadow DOM to apply custom styles and hide unwanted elements --- */
      const observer = new MutationObserver(() => {
        // Remove the image
        const kapaButtonImage = kapaWidget.querySelector('.mantine-Image-root');
        if (kapaButtonImage) {
          kapaButtonImage.style.display = 'none';
        }

        /**
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         * Layout / runtime JS styles
         * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         */
        const kapaStyles = kapaWidget.querySelector('style[data-mantine-styles="true"]');
        if (kapaStyles) {
          kapaStyles.textContent += `
            #kapa-button {
              position: unset;
              width: unset;
              height: unset;
              padding: 0;
              background-color: transparent;
              box-shadow: none;
              animation: none;
            }
  
            #kapa-button:hover {
              background-color: unset;
              opacity: 0.7;
            }
  
            .kapa-shadow-root-wrapper {
              display: flex;
              flex-direction: column;
              height: 100%;
            }
  
            .kapa-shadow-root-wrapper > div {
              flex: 50%;
              overflow-wrap: anywhere;
              text-align: center;
              line-height: 16px;
              align-content: center;
            }
  
            .support-container {
              border-bottom: 1px solid #3e3e3e;
              font-size: 14px;
              padding-bottom: 10px;
            }
  
            .support-container .support-link {
              text-decoration: none;
              color: var(--md-default-fg-color);
            }
  
            .support-container .support-link:hover {
              opacity: 0.7 !important;
            }
  
            #kapa-widget-root {
              padding-top: 10px;
            }
  
            .mantine-Text-root {
              line-height: 16px !important;
            }
            
            /* Light mode */
            .mantine-Button-root:hover {
              background-color: var(--color-surface);
            }

            :host-context([data-md-color-scheme="custom-light"])
            .mantine-Image-root {
              filter: invert(1);
            }

            :host-context([data-md-color-scheme="custom-light"])
            .mantine-Title-root {
              color: var(--color-text-primary);
            }

            :host-context([data-md-color-scheme="custom-dark"])
            .mantine-Modal-close {
              color: var(--color-text-primary);
            }

            :host-context([data-md-color-scheme="custom-dark"])
            .mantine-CloseButton-root:hover {
              background: var(--color-surface-secondary);
            }

            :host-context(body[data-search-open]) #kapa-button {
              z-index: 1;
            }
          `;
        }

        const kapaButtonText = kapaWidget.querySelector('.mantine-Text-root');
        if (kapaButtonText) {
          kapaButtonText.textContent = '';
          kapaButtonText.appendChild(document.createTextNode('Ask'));
          kapaButtonText.appendChild(document.createElement('br'));
          kapaButtonText.appendChild(document.createTextNode('AI'));
        }

        // Stop observing once we've modified everything
        observer.disconnect();
      });

      observer.observe(kapaWidget, { childList: true, subtree: true });
    });
  </script>
  <script>
    /**
     * AI Resources Page Interactivity
     * 
     * Purpose: Handle client-side interactivity (Download, Clipboard) that cannot be performed 
     * by the static HTML generator plugin (ai_resources_page).
     * 
     * The plugin generates the HTML structure with `data-path` attributes to ensure 
     * correct paths. This script consumes those paths to invoke browser APIs.
     */

    document.addEventListener('DOMContentLoaded', () => {

      // COPY buttons (use class selector .llms-copy)
      
      const copyButtons = document.querySelectorAll('.llms-copy');
      copyButtons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const targetPath = btn.getAttribute('data-path');
          if (!targetPath) return;

          try {
            const response = await fetch(targetPath);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            
            const text = await response.text();
            await navigator.clipboard.writeText(text);
            
            // Optional/Simple feedback
            alert('Copied to clipboard!');
          } catch (err) {
            console.error('Failed to copy file content:', err);
            alert('Failed to copy content.');
          }
        });
      });

      // DOWNLOAD buttons (use class selector .llms-dl)
      
      const dlButtons = document.querySelectorAll('.llms-dl');
      dlButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const targetPath = btn.getAttribute('data-path');
          const filename = btn.getAttribute('data-filename');
          if (!targetPath) return;

          const anchor = document.createElement('a');
          anchor.href = targetPath;
          if (filename) {
            anchor.download = filename;
          }
          document.body.appendChild(anchor);
          anchor.click();
          document.body.removeChild(anchor);
        });
      });

      // View functionality handled entirely by the generated HTML (href, target, rel).
      // No JS needed.

    });
  </script>
{% endblock %}
