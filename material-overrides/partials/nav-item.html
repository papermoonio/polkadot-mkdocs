{#-
  This file was automatically generated - do not edit
-#}

{% from "partials/macros.html" import render_title_with_icon %}

{% macro render(nav_item, path, level) %}
  {% set class = "md-nav__item" %}
  {% if nav_item.active %}
    {% set class = class ~ " md-nav__item--active" %}
  {% endif %}
  {% if nav_item.children %}
    {% if "navigation.sections" in features and level == 1 + (
      "navigation.tabs" in features
    ) %}
      {% set class = class ~ " md-nav__item--section" %}
    {% endif %}
    <li class="{{ class }} md-nav__item--nested">
      {% set expanded = "navigation.expand" in features %}
      {% set active = nav_item.active or expanded %}
      {% set checked = "checked" if nav_item.active %}
      {% if expanded and not checked %}
        {% set indeterminate = "md-toggle--indeterminate" %}
      {% endif %}
      <input class="md-nav__toggle md-toggle {{ indeterminate }}" type="checkbox" id="{{ path }}" {{ checked }}>
      {% set indexes = [] %}
      {% if "navigation.indexes" in features %}
        {% for child in nav_item.children %}
          {% if child.is_page and child.url.endswith(".index/") %}
            {% set _ = indexes.append(child) %}
          {% endif %}
          {% if child.is_index and not index is defined %}
            {% set _ = indexes.append(child) %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if not indexes %}
        <label class="md-nav__link" for="{{ path }}" id="{{ path }}_label" tabindex="0">
          {{ render_title_with_icon(nav_item.title, "twemoji nav-title") | safe }}
          <span class="md-nav__icon md-icon"></span>
        </label>
      {% else %}
        {% set index = indexes | first %}
        {% set class = "md-nav__link--active" if index == page %}
        <div class="md-nav__link md-nav__link--index {{ class }}">
          <a href="{{ index.url | url }}">{{ nav_item.title }}</a>
          {% if nav_item.children | length > 1 %}
            <label for="{{ path }}">
              <span class="md-nav__icon md-icon">
                <span class="closed">{% include ".icons/custom/right-chevron-circle.svg" %}</span>
                <span class="expanded">{% include ".icons/custom/down-chevron-circle.svg" %}</span>
              </span>
            </label>
          {% endif %}
        </div>
      {% endif %}

      {% set visible_children = [] %}
      {% for child in nav_item.children %}
        {% if not indexes or child != indexes | first %}
          {% set _ = visible_children.append({ 'idx': loop.index, 'node': child }) %}
        {% endif %}
      {% endfor %}

      {% if visible_children | length > 0 %}
        <nav class="md-nav"
             data-md-level="{{ level }}"
             aria-labelledby="{{ path }}_label"
             aria-expanded="{{ nav_item.active | tojson }}">

          <label class="md-nav__title" for="{{ path }}">
            <span class="md-nav__icon md-icon"></span>
            {{ nav_item.title }}
          </label>

          {% set indexes_class = indexes[0].url.replace('/', '-') if indexes and indexes[0] else '' %}
          <div class="nav-wrapper">
            <ul class="md-nav__list {{ indexes_class }}" data-md-scrollfix>
              {% for it in visible_children %}
                {{ render(it.node, path ~ "_" ~ it.idx, level + 1) }}
              {% endfor %}
            </ul>
          </div>
        </nav>
      {% endif %}
    </li>
  {% elif nav_item == page %}
    <li class="{{ class }}">
      {% set toc = page.toc %}
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      {% set first = toc | first %}
      {% if first and first.level == 1 %}
        {% set toc = first.children %}
      {% endif %}
      {% if toc %}
        <label class="md-nav__link md-nav__link--active" for="__toc">
          {{ render_title_with_icon(nav_item.title, "twemoji nav-title") | safe }}
          <span class="md-nav__icon md-icon"></span>
        </label>
      {% endif %}
      <div class="md-nav__link-wrapper {{ class }}">
        <a href="{{ nav_item.url | url }}" class="md-nav__link md-nav__link--active">
          {{ render_title_with_icon(nav_item.title, "twemoji nav-title") | safe }}
        </a>
      </div>
      {% if toc %}
        {% include "partials/toc.html" %}
      {% endif %}
    </li>
  {% else %}
    <li class="{{ class }}">
      <a href="{{ nav_item.url | url }}" class="md-nav__link">
        {{ render_title_with_icon(nav_item.title, "twemoji nav-title") | safe }}
      </a>
    </li>
  {% endif %}
{% endmacro %}
{{ render(nav_item, path, level) }}
